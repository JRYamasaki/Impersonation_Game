<head>
  <script type="text/javascript">
    function hideRequest() {
      var div = document.getElementById("response");
      div.style.visibility = 'hidden';
    }
  </script>
</head>

<nav class="navbar navbar-inverse">
	  	<div class="container-fluid">
		    <div class="navbar-header">
		    	<a class="navbar-brand">Impersonation Game</a>
		    </div>
		    <div class="collapse navbar-collapse" id="myNavbar">
			    <ul class="nav navbar-nav">
			        <li id="Home"><a href="/mainpage/mainpage">Home</a></li>
			    </ul>
			    <ul class="nav navbar-nav navbar-right">
			    	<li id="Logout"><%= link_to("Logout",access_logout_path) %></li>
			    </ul>
		    </div>
	  	</div>
	</nav>


<div class="vertical-center">
	<div id="waitingForPlayers" class="jumbotron jumbotron-fluid">
		<div class="container">
			<h2 class="display-3 text-center">Waiting for more players to join <%= @lobby.title %></h2>
			<p class="lead text-center"> <%= @lobby.spotsLeft %> / 4 players</p>
		</div>
	</div>







	<div id="waitingForInput" class="jumbotron jumbotron-fluid">
		<div class="container">
			<h2 class="display-3 text-center">Please enter a response</h2>
			<div class="form-group">
			<!-- above does not render  -->
				<div id="response" aria-describedby="userResponse">

					<!-- Successfully submitted responses: -->
					<%= render partial: 'responses/responses', collection: @lobby.responses || "There are no responses"%>

					<!-- Response form -->
					<%= render partial: '/responses/response_form', locals: {response: @response, lobby: @lobby}%>




				</div>

				<div id="response_box_<%= @current_user.username %>" class="responseBox">
				</div>
				<br>
				<div id="response_box_1_<%= @lobby.id %>" class="responseBox">
				</div>
				<br>
				<div id="response_box_2_<%= @lobby.id %>" class="responseBox">
				</div>
				<br>
				<div id="response_box_3_<%= @lobby.id %>" class="responseBox">
				</div>
				<br>
				<div id="response_box_4_<%= @lobby.id %>" class="responseBox">
				</div>
				<br>

			</div>
			

					<div id="scoreboard">
			<table>
				<%= render 'lobby_users' , collection: @lobby_users %>
			</table>
			<br />
		</div>
    			<!-- input type="response" class="form-control" id="response" aria-describedby="userResponse"> -->
  			</div>
  			Debugging tool: displays all attributes of current user
  			<%= debug(@bot_response) %>
			<%#= debug(@current_user) %>
		</div>






	</div>
</div>

<%= hidden_field_tag :current_id, params[:id] %>
<%= hidden_field_tag :current_player_count, @lobby.spotsLeft %>

<script>
	$(function() {
		var timer;
		var playerCountInLobby = $('#current_player_count').val();

		$(window).on("beforeunload", function(e) {
			decrementPlayerCount();
		})

		$("#Logout").click(function() {
			decrementPlayerCount();
		})

		$("#Home").click(function() {
			decrementPlayerCount();
		})

		$("#waitingForInput").hide(0);
		waitForPlayers();

		function decrementPlayerCount() {
			$.ajax({
				url: "/lobby/decrement_user_count/" + $('#current_id').val()
			})
		}

		function waitForPlayers() {
			if(playerCountInLobby == 4)
			{
				console.log($('#playerCount').val());
				$("#waitingForPlayers").delay(1000).slideUp(1500);
				$("#waitingForInput").delay(3000).slideToggle(1000);
				clearTimeout(timer);
			}
			else
			{
				$.ajax({
				url: "/lobby/update_player_count/" + $('#current_id').val(),
				data: {format: 'json'},
				datatype: "json",
				success: function(data) {
					playerCountInLobby = data.spotsLeft;
				}
				});
				console.log(playerCountInLobby);
				timer = setTimeout(waitForPlayers, 1000);
			}
		}
	});
</script>
